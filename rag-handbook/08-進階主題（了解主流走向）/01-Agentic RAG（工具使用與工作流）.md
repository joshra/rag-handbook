# 01-Agentic RAG（工具使用與工作流）

## 你將學到（Learning Objectives）

- 理解「Agentic RAG」跟一般 RAG 的差別：多步驟推理 + 工具調用
- 知道什麼情況值得做 agent（以及什麼情況不值得）
- 知道上線風險：成本、延遲、不可控性、越權

## 本章地圖

- **適合用在**：需要多步推理、工具使用與可控工作流的問答任務。
- **你會做出**：Agentic RAG 的風險/收益判斷與最小工作流設計原則。
- **最可能踩雷**：把 agent 當成魔法；缺乏權限/審計/成本控制。

## 什麼是 Agentic RAG

一般 RAG：一次檢索 → 一次生成。

Agentic RAG：模型會在一次請求中做多步驟：

- 分解問題（sub-questions）
- 多次檢索（每一步帶不同 query/filters）
- 可能調用工具（資料庫查詢、計算、外部 API）
- 最後整合成答案

## 什麼時候值得用

- 問題天然需要多步驟：例如「比較兩份規格差異」「依流程判斷適用條款」
- 需要工具：例如查庫、計算、查即時狀態
- 你能接受較高延遲/成本，並有足夠觀測與 guardrails

## 什麼時候不要用

- 你的問題其實是單步：FAQ、單條款查詢、單段落摘要
- 你沒有權限/審計/觀測能力（agent 很容易越界）
- 成本與延遲很敏感

## 上線必備控制點

- 工具白名單（只允許少數安全工具）
- 每步都有 trace（每次檢索/工具調用都可回放）
- 最大步數/最大成本限制（避免 runaway）
- 權限下沉（工具調用與檢索都要套用 tenant/ACL）

## 本章小結

- Agentic RAG 的價值在於多步工作流與工具使用，但治理成本顯著上升。
- 先用可觀測的 pipeline（retrieval→generate）打底，再逐步引入工具與狀態。
- 每一步都要納入權限、trace 與成本護欄，否則很難上線。

## 延伸閱讀

- [03-可觀測性：log-trace-命中率-失敗分類](../06-評估與觀測（讓工程團隊能迭代）/03-可觀測性：log-trace-命中率-失敗分類.md)
- [05-安全合規：PII-權限-審計-提示注入防護](../07-工程化與上線（Django+Postgres實作）/05-安全合規：PII-權限-審計-提示注入防護.md)
