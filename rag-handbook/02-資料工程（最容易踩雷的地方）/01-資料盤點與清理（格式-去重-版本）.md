# 01-資料盤點與清理（格式 / 去重 / 版本）

## 你將學到（Learning Objectives）

- 知道 RAG 導入的第一步不是「選模型」，而是「把資料變成可用資產」
- 能盤點資料來源並建立最小治理：來源、版本、權限、更新頻率
- 能建立清理規則：去重、去噪、正規化，避免索引污染

## 本章地圖

- **適合用在**：要把文件變成可索引資料，並確保可重跑與可追溯時。
- **你會做出**：資料盤點表、清理規則、版本策略與最小品質門檻。
- **最可能踩雷**：清理不可重跑、來源不可追溯、資料版本混在一起。

## 盤點清單（你可以直接拿去做導入會議）

每個資料源至少記錄：

- **owner**：誰負責（沒 owner 的資料源通常最後會變垃圾）
- **source_uri**：來源位置（URL/路徑/API）
- **格式**：PDF/HTML/Markdown/Docx/DB
- **更新頻率**：每日/每週/不定期
- **權限模型**：部門/角色/租戶/機密等級
- **可引用性**：是否有頁碼/章節/固定錨點

## 清理（讓 embedding/檢索不要被噪聲騙）

常見噪聲：

- header/footer、頁碼、目錄、版權頁
- 模板文字（「本文件為機密…」每頁重複）
- OCR 斷行/亂碼/重複段落

建議策略：

- **先做「可逆」清理**：保留原文，清理後文用於索引
- **建立清理版本**：cleaner_version（便於回補與回歸）
- **正規化**：全形半形、連續空白、常見符號（中文很常見）

## 去重（不做會發生什麼）

不去重的後果：

- 檢索 top-k 被重複 chunk 佔滿 → 多樣性差 → 生成更不穩
- rerank 成本上升

常見去重法（由簡到難）：

- **文件級 hash**：整份文件相同
- **chunk 級 hash**：段落相同（建議）
- **近似去重**：相似度高但不完全相同（進階，先不必）

## 版本化（導入場景最常忽略）

起手式：

- doc_version：內容變更就產生新版本（或用內容 hash）
- ingest_version：每次同步/導入批次 id（便於回溯）

這能讓你做到：

- 新舊版本並行建索引 → 切換 active 版本 → 線上不抖動

## 本章小結

- 資料工程的首要目標是「可重跑、可追溯、可回補」，不是一次性匯入。
- 去重與版本化會直接影響命中率與成本；沒有版本就沒有可靠的回歸測試。
- 先定義資料 owner、權限與更新頻率，才能談索引與上線維運。

## 延伸閱讀

- [02-Chunking切分策略（大小-重疊-結構化文件）](02-Chunking切分策略（大小-重疊-結構化文件）.md)
- [06-版本化與可重現：資料-索引-embedding-prompt版本](../07-工程化與上線（Django+Postgres實作）/06-版本化與可重現：資料-索引-embedding-prompt版本.md)
