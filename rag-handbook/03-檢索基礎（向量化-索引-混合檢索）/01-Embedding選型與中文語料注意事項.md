# 01-Embedding 選型與中文語料注意事項

## 你將學到（Learning Objectives）

- 知道 embedding 在 RAG 中扮演的角色（以及它不是萬靈丹）
- 能理解中文語料常見問題：術語、同義詞、半形全形、繁簡、混中英
- 能把 embedding「版本化」與「可重現」納入工程設計

## 本章地圖

- **適合用在**：要選 embedding 模型、或中文語料檢索效果不穩時。
- **你會做出**：embedding 選型準則、批次/限流策略與版本欄位。
- **最可能踩雷**：只換模型不修資料；embedding 版本混用導致回歸失真。

## Embedding 在做什麼

Embedding 把文字映射到向量空間，使得「語意相近」的文本距離更近。

RAG 的檢索品質通常取決於：

- **資料品質與切分**（上限）
- **metadata 與 filter**（安全與可用性）
- **檢索策略與 rerank**（把命中變準）
- embedding 本身是其中一塊，但不是唯一決定因素

## 中文文件常見雷點（與對策）

### 1) 繁簡/同義詞/術語

- 同一概念可能有繁簡、縮寫、英文縮寫（API/ACL/KPI）混用
- 對策：
  - 在清理階段做基本正規化（全形半形、常見符號）
  - 重要術語可建立同義詞表，用於 query expand（在檢索策略章）

### 2) 編號/條款/型號（語意向量不一定吃香）

- 例如「3.2.1」或「ABC-1234」這種精確字串，關鍵字檢索更穩
- 對策：
  - 混合檢索（全文 + 向量）
  - metadata 保留條款編號、型號欄位，支援精確 filter

### 3) 長句與無標點

- 中文文件常見長句/缺少標點，embedding 與切分都容易受影響
- 對策：
  - 切分時優先段落/標題，必要時加入規則斷句

## 選型建議（不綁供應商的思路）

你評估 embedding model 時，至少要問 4 件事：

- **維度（dimension）**：影響儲存、索引、速度；一旦上線就要穩定
- **語言覆蓋**：中文、繁簡、混中英表現如何
- **批次/吞吐**：能不能批次 embed（成本與速度關鍵）
- **授權與部署**：雲端 API / 本地模型（資料合規要求可能不同）

本手冊不指定特定供應商；你要確保的是：**介面一致 + 版本可追溯**。

## 工程化：embedding 版本化（必做）

你至少要記錄：

- embedding_model_name（或 id）
- embedding_model_version（若供應商未提供，你自己定義版本）
- embedding_dim
- embed_time（時間戳）
- normalization/cleaning 版本（若有）

為什麼要做：
- 你換模型後，檢索結果會變（這是正常的），但你需要能回溯與比較

## 本章小結

- embedding 選型要跟語料與 query 分佈對準；中文常見問題在斷詞、專有名詞與符號。
- 一定要把 embedding 的 model/dim/version 寫進資料，否則無法回放與回歸。
- 批次化與快取通常比「換更大模型」更能穩定成本與延遲。

## 延伸閱讀

- [02-Chunking切分策略（大小-重疊-結構化文件）](../02-資料工程（最容易踩雷的地方）/02-Chunking切分策略（大小-重疊-結構化文件）.md)
- [06-版本化與可重現：資料-索引-embedding-prompt版本](../07-工程化與上線（Django+Postgres實作）/06-版本化與可重現：資料-索引-embedding-prompt版本.md)
