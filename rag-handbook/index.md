# RAG 手冊（從初學到可上線）

本手冊目標：讓工程團隊在**不綁定特定 LLM 供應商**的前提下，理解並能在既有 **Python + Django + PostgreSQL** 場景中導入主流 RAG（Retrieval-Augmented Generation）作法，包含資料工程、檢索策略、生成可靠性、評估觀測與上線工程化。

## 本書慣例（Conventions）

為了讓整本手冊讀起來有一致的「歐萊禮式節奏」，我們採用固定的章節骨架與側欄格式：

- **章節骨架**：每章至少包含「你將學到 → 本章地圖 → 主文 → 本章小結 → 延伸閱讀」。
- **側欄（admonitions）**：用來放不打斷主線但一定要看的重點（起手式、風險、常見誤解）。
- **寫作規範**：若你要擴寫/新增章節，請先看 `STYLEGUIDE.md`。

## 你讀完會得到什麼

- **能判斷什麼場景適合 RAG**，並用清楚的 KPI 定義成功
- **能設計資料切分與 metadata**，避免「索引建了但用不了」
- **能用 Postgres + pgvector** 做一套可用的向量檢索，並理解何時要升級到專用向量庫
- **能用混合檢索 + rerank** 提升命中率，降低幻覺
- **能在 Django 架構中導入**：單體/分離服務/背景任務/權限與審計/版本化

## 章節導覽

### 00-導讀

- [00-手冊使用方式](00-導讀/00-手冊使用方式.md)
- [01-名詞表與縮寫](00-導讀/01-名詞表與縮寫.md)
- [02-主流工具版圖（LangChain-LlamaIndex-Haystack）](00-導讀/02-主流工具版圖（LangChain-LlamaIndex-Haystack）.md)

### 01-總覽（從0到上線的RAG藍圖）

- [01-RAG是什麼與適用場景](01-總覽（從0到上線的RAG藍圖）/01-RAG是什麼與適用場景.md)
- [02-端到端資料流與系統架構](01-總覽（從0到上線的RAG藍圖）/02-端到端資料流與系統架構.md)
- [03-成功標準與KPI（正確率-覆蓋率-成本-延遲）](01-總覽（從0到上線的RAG藍圖）/03-成功標準與KPI（正確率-覆蓋率-成本-延遲）.md)

### 02-資料工程（最容易踩雷的地方）

- [01-資料盤點與清理（格式-去重-版本）](02-資料工程（最容易踩雷的地方）/01-資料盤點與清理（格式-去重-版本）.md)
- [02-Chunking切分策略（大小-重疊-結構化文件）](02-資料工程（最容易踩雷的地方）/02-Chunking切分策略（大小-重疊-結構化文件）.md)
- [03-Metadata與權限欄位設計（ACL-租戶隔離）](02-資料工程（最容易踩雷的地方）/03-Metadata與權限欄位設計（ACL-租戶隔離）.md)

### 03-檢索基礎（向量化/索引/混合檢索）

- [01-Embedding選型與中文語料注意事項](03-檢索基礎（向量化-索引-混合檢索）/01-Embedding選型與中文語料注意事項.md)
- [02-向量索引與相似度（cosine-dot-L2）](03-檢索基礎（向量化-索引-混合檢索）/02-向量索引與相似度（cosine-dot-L2）.md)
- [03-混合檢索（BM25+向量）與何時要用](03-檢索基礎（向量化-索引-混合檢索）/03-混合檢索（BM25+向量）與何時要用.md)

### 04-檢索策略（把找回來的內容變準）

- [01-Query改寫-擴展（rewrite-expand）](04-檢索策略（把找回來的內容變準）/01-Query改寫-擴展（rewrite-expand）.md)
- [02-top-k-filter-MMR-多路召回](04-檢索策略（把找回來的內容變準）/02-top-k-filter-MMR-多路召回.md)
- [03-Rerank（二階段檢索）與常見模型](04-檢索策略（把找回來的內容變準）/03-Rerank（二階段檢索）與常見模型.md)

### 05-生成策略（把答案變可靠）

- [01-Context組裝（packing）與引用格式](05-生成策略（把答案變可靠）/01-Context組裝（packing）與引用格式.md)
- [02-Prompt模板（可回答-不可回答-追問澄清）](05-生成策略（把答案變可靠）/02-Prompt模板（可回答-不可回答-追問澄清）.md)
- [03-降低幻覺的防線（guardrails-證據不足處理）](05-生成策略（把答案變可靠）/03-降低幻覺的防線（guardrails-證據不足處理）.md)

### 06-評估與觀測（讓工程團隊能迭代）

- [01-離線評估：Retrieval-Answer指標與資料集](06-評估與觀測（讓工程團隊能迭代）/01-離線評估：Retrieval-Answer指標與資料集.md)
- [02-線上評估：A-B-回饋循環-人工標註流程](06-評估與觀測（讓工程團隊能迭代）/02-線上評估：A-B-回饋循環-人工標註流程.md)
- [03-可觀測性：log-trace-命中率-失敗分類](06-評估與觀測（讓工程團隊能迭代）/03-可觀測性：log-trace-命中率-失敗分類.md)

### 07-工程化與上線（Django+Postgres實作）

- [01-系統切分：Ingest-Index-Retrieve-Generate服務邊界](07-工程化與上線（Django+Postgres實作）/01-系統切分：Ingest-Index-Retrieve-Generate服務邊界.md)
- [02-PostgreSQL+pgvector導入（schema-索引-查詢樣式）](07-工程化與上線（Django+Postgres實作）/02-PostgreSQL+pgvector導入（schema-索引-查詢樣式）.md)
- [03-Django整合：API設計-背景任務-快取-速率限制](07-工程化與上線（Django+Postgres實作）/03-Django整合：API設計-背景任務-快取-速率限制.md)
- [04-效能與成本：快取-批次-串流-降延遲](07-工程化與上線（Django+Postgres實作）/04-效能與成本：快取-批次-串流-降延遲.md)
- [05-安全合規：PII-權限-審計-提示注入防護](07-工程化與上線（Django+Postgres實作）/05-安全合規：PII-權限-審計-提示注入防護.md)
- [06-版本化與可重現：資料-索引-embedding-prompt版本](07-工程化與上線（Django+Postgres實作）/06-版本化與可重現：資料-索引-embedding-prompt版本.md)

### 08-進階主題（了解主流走向）

- [01-Agentic RAG（工具使用與工作流）](08-進階主題（了解主流走向）/01-Agentic RAG（工具使用與工作流）.md)
- [02-多模態RAG（圖片-表格）](08-進階主題（了解主流走向）/02-多模態RAG（圖片-表格）.md)
- [03-Graph RAG與知識圖譜（何時值得）](08-進階主題（了解主流走向）/03-Graph RAG與知識圖譜（何時值得）.md)

### 09-導入既有場景（工程團隊導入配方）

- [01-導入路線圖（PoC→試點→正式）](09-導入既有場景（工程團隊導入配方）/01-導入路線圖（PoC→試點→正式）.md)
- [02-文件型知識庫配方（企業內規-手冊-規格）](09-導入既有場景（工程團隊導入配方）/02-文件型知識庫配方（企業內規-手冊-規格）.md)
- [03-研發型知識庫配方（issues-PRD-設計文-ADR）](09-導入既有場景（工程團隊導入配方）/03-研發型知識庫配方（issues-PRD-設計文-ADR）.md)

### 10-實作案例（Django+PostgreSQL最小MVP）

- [01-用 Django + PostgreSQL 實作最小 RAG MVP（可回放、可上線起跑）](10-實作案例（Django+PostgreSQL最小MVP）/01-用Django+PostgreSQL實作最小RAG-MVP.md)

### 11-附錄

- [01-Checklist（上線前-事故後）](11-附錄/01-Checklist（上線前-事故後）.md)
- [02-FAQ（常見誤解與坑）](11-附錄/02-FAQ（常見誤解與坑）.md)
- [03-參考文獻與延伸閱讀](11-附錄/03-參考文獻與延伸閱讀.md)

## 範例專案

在 `examples/django-rag-service/` 會提供最小可直接導入骨架（Postgres+pgvector、ingest/index、檢索 API、LLM 抽象介面）。

