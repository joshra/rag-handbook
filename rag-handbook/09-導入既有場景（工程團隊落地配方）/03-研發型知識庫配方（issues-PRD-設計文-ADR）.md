# 03-研發型知識庫配方（issues / PRD / 設計文 / ADR）

## 適用場景

- 研發文件分散：PRD、設計文、ADR、issue、runbook
- 問題常帶上下文：版本、服務、時間、owner

## 起手式（推薦）

- 資料源：先從「最穩定且結構最好」的開始（ADR/設計文通常比 issue 好）
- chunking：
  - 保留標題路徑（設計文 H1/H2）
  - 保留 code block（但要避免過長）
- metadata：
  - repo/service、版本、作者、日期、狀態（draft/final）
  - issue/PR 連結（引用時很好用）

## 檢索策略

- 混合檢索（關鍵字對版本號/錯誤碼很重要）
- 多路召回：
  - 向量：描述性問題
  - 全文：錯誤碼、函式名、參數名
- rerank：把「真正能回答」的段落拉到前面

## 生成策略

- 強制引用（避免模型自己補上不存在的細節）
- 允許輸出「建議下一步」但要標註是推測/建議，不是文件事實

## 常見坑

- issue 訊息噪聲很大（聊天、片段資訊）→ 先做清理與分類
- 沒有版本化（舊設計文被當成現行）→ doc_version/active_version 必做

## 本章小結

- 研發型知識的關鍵是版本與關聯：狀態（open/closed）、時間、repo/PR/issue 連結要進 metadata。
- 查詢通常需要混合檢索（關鍵字/代碼/ID）＋向量（語意）；rerank 是常見必要品。
- 引用要能回到原始 issue/PR/ADR，並在答案中標示「是否已過期」。

## 延伸閱讀

- [03-混合檢索（BM25+向量）與何時要用](../03-檢索基礎（向量化-索引-混合檢索）/03-混合檢索（BM25+向量）與何時要用.md)
- [03-Metadata與權限欄位設計（ACL-租戶隔離）](../02-資料工程（最容易踩雷的地方）/03-Metadata與權限欄位設計（ACL-租戶隔離）.md)
